<html>
<body>
<div id="div1">
<h1 style="text-align: center;"><strong>Song Request Commands</strong></h1>
<p style="text-align: center;"><strong>This stream supports song requests from a pre-determined list. The commands below will list what commands work.</strong></p>
<p style="text-align: center;"><strong>!replace to replace your song in the queue. !currentsong to view the current song</strong></p>
<hr>
</div>
<script>
	function loadJSON(callback) {   
		var xobj = new XMLHttpRequest();
		xobj.overrideMimeType("application/json");
		xobj.open('GET', 'songs.json', true);
		xobj.onreadystatechange = function () {
			if (xobj.readyState == 4 && xobj.status == "200") {
				callback(JSON.parse(xobj.responseText));
			}
		};
		xobj.send(null);  
	}
	
	
	function compare( a, b ) {
		console.log(a,b)
		let aProp = (a["game"] || a["author"] || a["name"] || "???")
		let bProp = (a["game"] || a["author"] || a["name"] || "???")
		console.log(aProp,bProp)
		if ( aProp < bProp ){
			return -1;
		}
		if ( aProp > bProp ){
			return 1;
		}
		return 0;
	}
	
	function sortData(data) {
		let ordered = {};
		let compareFunction = compare
		Object.keys(data).sort(compareFunction).forEach(function(key) {
			ordered[key] = data[key];
		});
		return ordered;
	}
	
	
	
	
	loadJSON(function(json) {
		json = JSON.stringify(json);
		var songs = JSON.parse(json);
		songs = sortData(songs)
		Object.keys(songs).forEach(async function (index){
			var song = await songs[index]
			if(song) {
				let songText = (song["name"] || index || "???") + " - " + (song["game"] || song["author"] || "???")
			
				let title = document.createElement("H2");
				let titleText = document.createTextNode(songText);
				title.appendChild(titleText);
				title.style = "text-align: center;"
				
				let command = document.createElement("P");
				let commandText = document.createTextNode("!add "+index);
				command.appendChild(commandText);
				command.style = "text-align: center;"
				
				var element = document.getElementById("div1");
				element.appendChild(title);
				element.appendChild(command);
			}
		})
	})
</script>
</body>
</html>