<html>
<body style="background-color:black;">
<div id="div1" style="display:none;">
<button onclick="swapLightDark()">Swap between light/dark</button>
<h1 style="font-family:arial black; text-align: center; color:#FFFFFF"><strong>Song Request Commands</strong></h1>
<p style="font-family:arial black; text-align: center; color:#FFFFFF"><strong>This stream supports song requests from a pre-determined list. The commands below will list what commands work.</strong></p>
<p style="font-family:arial black; text-align: center; color:#FFFFFF"><strong>!replace to replace your song in the queue. !currentsong to view the current song</strong></p>
<p style="font-family:arial black; text-align: center; color:#FFFFFF"><strong>Sorry that this page looks awful. I am not a web designer.</strong></p>
<hr>
</div>
<hr>
<hr style="width:15%; color:#FFFFFF">
<p style="font-family:arial black; text-align: center; color:#FFFFFF"><a href="https://www.twitch.tv/nubz4lifstream" style="font-family:arial black; text-align: center; color:#FFFFFF">twitch.tv/nubz4lifstream</a></p>
<!-- <div id="rndcmd" style="display:none;">
<h1 style="font-family:arial black; text-align: center; color:#FFFFFF"><strong>Random</strong></h2>
<p style="font-family:arial black; text-align: center; color:#FFFFFF">!add random</p>
</div> -->
<script>
	// I am awful at coding javascript, sorry for people who know how to actually code javascript :(
	function loadJSON(callback) {   
		var xobj = new XMLHttpRequest();
		xobj.overrideMimeType("application/json");
		xobj.open('GET', 'songs.json?nocache=' + new Date().getTime(), true);
		xobj.onreadystatechange = function () {
			if (xobj.readyState == 4 && xobj.status == "200") {
				callback(JSON.parse(xobj.responseText));
			}
		};
		xobj.send(null);  
	}
	
	var songs = []
	function compare( a, b ) {
		a = songs[a]
		b = songs[b]
		let aProp = (a["game"] || a["author"] || a["name"] || "???")
		let bProp = (b["game"] || b["author"] || b["name"] || "???")
		let aName = a["name"] || "???"
		let bName = b["name"] || "???"
		if ( aProp < bProp ){
			return -1;
		}
		if ( aProp > bProp ){
			return 1;
		}
		if ( aName < bName ) {
			return -1
		}
		if ( aName > bName ) {
			return 1
		}
		return 0;
	}
	
	function sortData(data) {
		let ordered = {};
		let compareFunction = compare
		Object.keys(data).sort(compareFunction).forEach(function(key) {
			ordered[key] = data[key];
		});
		return ordered;
	}
	
	function getAllCategories(songs) {
		let categories = []
		Object.keys(songs).forEach(async function(index) {
			var song = songs[index]
			var songCategory = song['category'] || song['game'] || song['author'] || 'Other'
			
			if(!categories.includes(songCategory)) {
				categories.unshift(songCategory)
			}
		})
		return categories.sort(function(a,b) {
			var nameA = a.toLowerCase()
			var nameB = b.toLowerCase()
			
			if(nameA == "other") {
				return 1
			}
			else if(nameB == "other") {
				return -1
			}
			
			if (nameA < nameB) {
				return -1;
			}
			if (nameA > nameB) {
				return 1;
			}

			return 0;
		})
	}
	
	
	loadJSON(function(json) {
		json = JSON.stringify(json);
		songs = JSON.parse(json);
		//songs = sortData(songs)
		let categories = getAllCategories(songs)
		//console.log(categories)
		categories.forEach(async function (catIndex){
			let category = document.createElement("H1");
			let categoryText = document.createTextNode(catIndex);
			category.appendChild(categoryText);
			category.style = "font-family:arial black; text-align: center; color:#FFFFFF"
			var element = document.getElementById("div1");
			
			let hrLine = document.createElement("HR")
			hrLine.style = "width:60%; color:#FFFFFF"
			element.appendChild(hrLine)
			
			element.appendChild(category);
			
			let hrLine2 = document.createElement("HR")
			hrLine2.style = "width:50%; color:#FFFFFF"
			element.appendChild(hrLine2)
			
			let pastFirstOne = false
			Object.keys(songs).forEach(function (index){
				let song = songs[index]
				let songCategory = song['category'] || song['game'] || song['author'] || 'Other'
				let songText = (song['site_name'] || song["name"] || index || "???")
				if(song && songCategory == catIndex) {
					let title = document.createElement("H2");
					let titleText = document.createTextNode(songText);
					title.appendChild(titleText);
					title.style = "font-family:arial black; text-align: center; color:#FFFFFF"
					
					let command = document.createElement("P");
					let commandText = document.createTextNode("!add "+index);
					command.appendChild(commandText);
					command.style = "font-family:arial black; text-align: center; color:#FFFFFF"
					
					if(pastFirstOne) {
						let hrLine3 = document.createElement("HR")
						hrLine3.style = "width:30%; color:#FFFFFF"
						element.appendChild(hrLine3)
					}
					pastFirstOne = true
					
					element.appendChild(title);
					element.appendChild(command);
					title.style = "font-family:arial black; text-align: center; color:#FFFFFF"
				}
			})
			//let hrLine4 = document.createElement("HR")
			//hrLine4.style = "width:30%; color:#FFFFFF"
			//element.appendChild(hrLine4)
		})
		document.getElementById('div1').style.display = "block"
		
		let rndcmdElement = document.getElementById('rndcmd')
		if(rndcmdElement) {
			rndcmdElement.style.display = "block"
		}
	})
	
	const params = new URLSearchParams(window.location.search)
	lightModeOn = Number(params.get('light') || 0) > 0
	
	function swapLightDark() {
		params.set('light', (!(lightModeOn || false) ? 1 : 0));

		window.history.replaceState({}, '', `${location.pathname}?${params}`);
		location.reload()
	}
	
	if(lightModeOn) {
		javascript: (
			function () { 
			// the css we are going to inject
			var css = 'html {-webkit-filter: invert(100%);' +
				'-moz-filter: invert(100%);' + 
				'-o-filter: invert(100%);' + 
				'-ms-filter: invert(100%); }',

			head = document.getElementsByTagName('head')[0],
			style = document.createElement('style');

			// a hack, so you can "invert back" clicking the bookmarklet again
			if (!window.counter) { window.counter = 1;} else  { window.counter ++;
			if (window.counter % 2 == 0) { var css ='html {-webkit-filter: invert(0%); -moz-filter:    invert(0%); -o-filter: invert(0%); -ms-filter: invert(0%); }'}
			 };

			style.type = 'text/css';
			if (style.styleSheet){
			style.styleSheet.cssText = css;
			} else {
			style.appendChild(document.createTextNode(css));
			}

			//injecting the css to the head
			head.appendChild(style);
		}());
	}
</script>
</body>
</html>