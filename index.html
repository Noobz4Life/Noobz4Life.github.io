<html>
<body style="background-color:black;">
<div id="div1" style="display:none;">
<h1 style="font-family:arial black; text-align: center; color:#FFFFFF"><strong>Song Request Commands</strong></h1>
<p style="font-family:arial black; text-align: center; color:#FFFFFF"><strong>This stream supports song requests from a pre-determined list. The commands below will list what commands work.</strong></p>
<p style="font-family:arial black; text-align: center; color:#FFFFFF"><strong>!replace to replace your song in the queue. !currentsong to view the current song</strong></p>
<p style="font-family:arial black; text-align: center; color:#FFFFFF"><strong>Sorry that this page looks awful. I am not a web designer.</strong></p>
<hr>
</div>
<div id="rndcmd" style="display:none;">
<h2 style="font-family:arial black; text-align: center; color:#FFFFFF"><strong>Random</strong></h2>
<p style="font-family:arial black; text-align: center; color:#FFFFFF">!add random</p>
</div>
<script>
	// I am awful at coding javascript, sorry for people who know how to actually code javascript :(
	function loadJSON(callback) {   
		var xobj = new XMLHttpRequest();
		xobj.overrideMimeType("application/json");
		xobj.open('GET', 'songs.json?nocache=' + new Date().getTime(), true);
		xobj.onreadystatechange = function () {
			if (xobj.readyState == 4 && xobj.status == "200") {
				callback(JSON.parse(xobj.responseText));
			}
		};
		xobj.send(null);  
	}
	
	var songs = []
	function compare( a, b ) {
		a = songs[a]
		b = songs[b]
		let aProp = (a["game"] || a["author"] || a["name"] || "???")
		let bProp = (b["game"] || b["author"] || b["name"] || "???")
		let aName = a["name"] || "???"
		let bName = b["name"] || "???"
		console.log(aName,bName)
		if ( aProp < bProp ){
			return -1;
		}
		if ( aProp > bProp ){
			return 1;
		}
		if ( aName < bName ) {
			return -1
		}
		if ( aName > bName ) {
			return 1
		}
		return 0;
	}
	
	function sortData(data) {
		let ordered = {};
		let compareFunction = compare
		Object.keys(data).sort(compareFunction).forEach(function(key) {
			ordered[key] = data[key];
		});
		return ordered;
	}
	
	
	
	
	loadJSON(function(json) {
		json = JSON.stringify(json);
		songs = JSON.parse(json);
		songs = sortData(songs)
		Object.keys(songs).forEach(async function (index){
			var song = await songs[index]
			if(song) {
				let songText = (song['site_name'] || song["name"] || index || "???") + " - " + (song["game"] || song["author"] || "???")
			
				let title = document.createElement("H2");
				let titleText = document.createTextNode(songText);
				title.appendChild(titleText);
				title.style = "font-family:arial black; text-align: center; color:#FFFFFF"
				
				let command = document.createElement("P");
				let commandText = document.createTextNode("!add "+index);
				command.appendChild(commandText);
				command.style = "font-family:arial black; text-align: center; color:#FFFFFF"
				
				var element = document.getElementById("div1");
				element.appendChild(title);
				element.appendChild(command);
			}
		})
		document.getElementById('div1').style.display = "block"
		document.getElementById('rndcmd').style.display = "block"
	})
</script>
</body>
</html>